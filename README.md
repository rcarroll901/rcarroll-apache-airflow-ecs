# Apache Airflow ECS Cluster

I built this infrastructure to host an Apache Airflow ETL pipeline and manage a series of interweaving tasks of scraping, transforming, uploading, and analyzing data. 

This AWS Elastic Container Service (ECS) cluster took advantage of Apache Airflow's CeleryExecutor to parallelize task execution along with RabbitMQ as the messenger to communicate tasks between the different nodes (flower, scheduler, workers, webserver). 

The small VPC is relatively standard with a single private subnet (for the nodes and RDS cluster) and single public subnet (to host the webserver + NAT), and I built it from the ground up, including security groups, routing tables, subnets, etc... Because I used Fargate instances which could not be assigned an EIP, the cluster used AWS Service Discovery to keep nodes fixed on the queue node's private IP which changed as the cluster was started and stopped. 

Soon after I completed this infrastructure, AWS released their own ["Managed Workflows for Apache Airflow"](https://aws.amazon.com/blogs/aws/introducing-amazon-managed-workflows-for-apache-airflow-mwaa/) which is unquestionably superior to this. This cluster worked well for many purposes, but I also soon realized the power of AWS Lambda and laid this cluster to rest. 

It was also a great learning experience as it was my first in-depth project with building a larger Terraform/AWS infrastructure from scratch. There are certainly imporovements to be made including modularizing repeated blocks of code within my configuration (and taking advantage of pre-defined modules from the Terraform Registry), adding CI/CD for the infrastructure, including additional subnets in different AZs for high-availability, and many more. An immature, massively oversimplified predecessor/local version of the Apache Airflow DAG which this ECS cluster hosted can be found in my [simplified-airflow-criminal-justice-etl](https://github.com/rcarroll901/simple-airflow-criminal-justice-etl/blob/master/README.md) repository. That repo was done as a demo when I was learning Airflow and the mature version of it (+ this repo) is now private and transferred to the [Just City](https://github.com/just-city) organization.

I was and still am very proud of this non-DRY, clunky Terraform configuration, and I wanted to include it as a public repo because I found (1) many of the resources on Medium, DEV, etc... to be lacking **key** details and (2) a dearth of repositories on GitHub and the few that existed at the time included Terraform configurations -- which were very clean and well done -- that obfuscate the underlying details with advanced Terraform code, causing them to be inaccessible for a relative novice. 
